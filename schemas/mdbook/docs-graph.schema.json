{
  "$id": "https://schemas.arusty.dev/mdbook/docs-graph.schema.json",
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "MDBook Document Graph",
  "description": "Schema for the document relationship graph generated by mdbook-doc-graph. Represents nodes (documents) and edges (relationships) for visualization, querying, and impact analysis.",
  "type": "object",
  "$defs": {
    "uuid": {
      "type": "string",
      "pattern": "^[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$",
      "description": "UUID v4 format identifier"
    },
    "isoDateTime": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp"
    },
    "isoDate": {
      "type": "string",
      "format": "date",
      "description": "ISO 8601 date (YYYY-MM-DD)"
    },
    "nodeId": {
      "type": "string",
      "pattern": "^[a-z0-9][a-z0-9-]*[a-z0-9]$|^[a-z0-9]$",
      "description": "Unique identifier for a node (lowercase, hyphenated)"
    },
    "documentType": {
      "type": "string",
      "enum": ["adr", "doc", "blog", "note"],
      "description": "Classification of the document type"
    },
    "edgeType": {
      "type": "string",
      "enum": [
        "supersedes",
        "superseded_by",
        "decision",
        "decided_by",
        "implements",
        "implemented_by",
        "resulted_in",
        "resulted_from",
        "based_on",
        "contributed_to",
        "became",
        "originated_from",
        "see_also",
        "watches",
        "watched_by"
      ],
      "description": "Type of relationship between documents"
    },
    "nodeMetadata": {
      "type": "object",
      "properties": {
        "title": {
          "type": "string",
          "minLength": 1,
          "maxLength": 200,
          "description": "Document title"
        },
        "status": {
          "type": "string",
          "description": "Document status (e.g., draft, accepted, deprecated)"
        },
        "created": {
          "$ref": "#/$defs/isoDate",
          "description": "Date the document was created"
        },
        "updated": {
          "$ref": "#/$defs/isoDate",
          "description": "Date the document was last updated"
        },
        "tags": {
          "type": "array",
          "items": { "type": "string" },
          "uniqueItems": true,
          "description": "Categorization tags"
        },
        "audience": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["user", "admin", "developer", "exec", "manager"]
          },
          "uniqueItems": true,
          "description": "Target audiences for the document"
        },
        "level": {
          "type": "string",
          "enum": ["noob", "beginner", "intermediate", "advanced"],
          "description": "Expertise level required"
        }
      },
      "required": ["title"],
      "additionalProperties": true
    },
    "node": {
      "type": "object",
      "properties": {
        "id": {
          "$ref": "#/$defs/nodeId",
          "description": "Unique identifier for the node"
        },
        "uuid": {
          "$ref": "#/$defs/uuid",
          "description": "UUID from the document frontmatter"
        },
        "path": {
          "type": "string",
          "pattern": "^[^/].*\\.md$",
          "description": "Relative path to the markdown file"
        },
        "type": {
          "$ref": "#/$defs/documentType"
        },
        "metadata": {
          "$ref": "#/$defs/nodeMetadata"
        }
      },
      "required": ["id", "path", "type", "metadata"],
      "additionalProperties": false
    },
    "edgeMetadata": {
      "type": "object",
      "properties": {
        "note": {
          "type": "string",
          "maxLength": 500,
          "description": "Human-readable note about the relationship"
        },
        "auto": {
          "type": "boolean",
          "default": false,
          "description": "Whether this edge was auto-generated as an inverse"
        },
        "generated_at": {
          "$ref": "#/$defs/isoDateTime",
          "description": "Timestamp when auto-generated (only if auto=true)"
        }
      },
      "additionalProperties": false
    },
    "edge": {
      "type": "object",
      "properties": {
        "source": {
          "$ref": "#/$defs/nodeId",
          "description": "Source node ID"
        },
        "target": {
          "$ref": "#/$defs/nodeId",
          "description": "Target node ID"
        },
        "type": {
          "$ref": "#/$defs/edgeType"
        },
        "metadata": {
          "$ref": "#/$defs/edgeMetadata"
        }
      },
      "required": ["source", "target", "type"],
      "additionalProperties": false
    },
    "statistics": {
      "type": "object",
      "properties": {
        "total_nodes": {
          "type": "integer",
          "minimum": 0,
          "description": "Total number of nodes in the graph"
        },
        "total_edges": {
          "type": "integer",
          "minimum": 0,
          "description": "Total number of edges in the graph"
        },
        "nodes_by_type": {
          "type": "object",
          "propertyNames": {
            "$ref": "#/$defs/documentType"
          },
          "additionalProperties": {
            "type": "integer",
            "minimum": 0
          },
          "description": "Count of nodes grouped by document type"
        },
        "edges_by_type": {
          "type": "object",
          "propertyNames": {
            "$ref": "#/$defs/edgeType"
          },
          "additionalProperties": {
            "type": "integer",
            "minimum": 0
          },
          "description": "Count of edges grouped by relationship type"
        },
        "orphaned_nodes": {
          "type": "array",
          "items": { "type": "string" },
          "description": "List of file paths for nodes with no edges"
        }
      },
      "required": ["total_nodes", "total_edges"],
      "additionalProperties": false
    }
  },
  "properties": {
    "version": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+$",
      "description": "Schema version for the graph format"
    },
    "generated_at": {
      "$ref": "#/$defs/isoDateTime",
      "description": "Timestamp when the graph was generated"
    },
    "nodes": {
      "type": "array",
      "items": {
        "$ref": "#/$defs/node"
      },
      "description": "List of document nodes"
    },
    "edges": {
      "type": "array",
      "items": {
        "$ref": "#/$defs/edge"
      },
      "description": "List of relationship edges"
    },
    "statistics": {
      "$ref": "#/$defs/statistics",
      "description": "Summary statistics about the graph"
    }
  },
  "required": ["version", "generated_at", "nodes", "edges"],
  "additionalProperties": false
}
